## Guide simplifi√© : Python ü°í Docker ü°í Docker Compose ü°í Makefile  
*(pens√© pour un¬∑e d√©butant¬∑e)*

---

### 1. Pr√©parer l‚Äôapplication Python

```bash
# 1) Cr√©er et activer un environnement virtuel
python -m venv .venv
source .venv/bin/activate      # (Windows : .venv\Scripts\activate)

# 2) Installer les d√©pendances
pip install --upgrade pip
pip install -r requirements.txt
```

> **Pourquoi ?**  
> L‚Äôenvironnement virtuel √©vite de polluer le Python syst√®me ; tout reste contenu dans le dossier `.venv`.

---

### 2. Docker de base

| Commande | Effet | Options utiles |
|----------|-------|----------------|
| `docker build -t monapp:latest .` | Construit l‚Äôimage √† partir du `Dockerfile` courant. | `-t` : nom et tag<br>`.` : contexte de build |
| `docker run --rm -it monapp:latest` | Lance un conteneur interactif puis le supprime √† l‚Äôarr√™t. | `-d` : **d**√©tach√© (arri√®re-plan)<br>`-p 8080:8080` : publie un port<br>`--name mydemo` : nom lisible |

> **Astuce** : le flag `-d` (detached) fait tourner le conteneur ¬´ en arri√®re-plan ¬ª ; combinez-le avec `docker logs -f <id>` pour suivre la sortie.

---

### 3. Docker Compose

*Lancer toute l‚Äôinfra d√©crite dans un ou plusieurs fichiers Compose.*

- **Simple :**

  ```bash
  docker compose up -d           # lit le docker-compose.yml par d√©faut
  ```

- **Multi-fichiers (overlay)** :

  ```bash
  docker compose \
      -f base.yml \
      -f monitoring.yml \
      -f workflow-attacker.yml \
      up -d
  ```

  1. Les fichiers sont **fusionn√©s de gauche √† droite**.  
  2. Une cl√© d√©j√† d√©finie est **√©cras√©e** par la m√™me cl√© du fichier suivant.  
  3. Vous pouvez donc :  
     * *surcharger* un service existant (changer l‚Äôimage, ajouter des volumes).  
     * *ajouter* de nouveaux services sans toucher aux autres fichiers.

---

### 4. Makefile : automatiser sans r√©fl√©chir

> **Objectif :** encapsuler vos sc√©narios dans des cibles courtes (ex. `make start`).

```makefile
# -------- variables r√©utilisables --------
DOCKER:= @docker
IMAGE=custum-network-analysis
REGISTRY=registry.gitlab.com/maissacrement
VERSION=1.0.0

new-workflow-attacker:
    # Here your script
    echo "bonjour depuis make nous allons lancez le workflow 'new-workflow-attacker'"

### Execute workflow shell ###

workflow-attack-example:
	docker compose -f ./monitoring.yml -f ./docker-compose.yml -f ./nginx-workflow.yml up --build

```

#### Points cl√©s pour d√©butants

| Concept | Pourquoi c‚Äôest utile ? |
|---------|------------------------|
| **Variables Make** (`DOCKER=`) | √âviter de taper 3 km de chemin √† chaque fois. Nous permet d'utiliser la variable docker comme commande dans make |
| **Cibles `new-workflow-attacker`** | Zone de redaction de nos workflows et automatisation script√© |
| `##` apr√®s une r√®gle | Devient une *docstring* lisible via `make help` (si on ajoute une petite cible `help`). |
| Une cible = un sc√©nario | Vous pouvez cr√©er `make stress-test`, `make restore-db`, etc. |

---

### 5. Workflow conseill√©

1. **`make run-project-analysis`** : Analyse les images d√©finies dans un fichier `docker-compose.yml` et g√©n√®re un rapport `docker-compose-images-vuln.txt` listant toutes les vuln√©rabilit√©s (CVE) par image et d√©pendances.  
2. **`make running-container-analisis`** : Analyse les conteneurs Docker **actuellement en cours d'ex√©cution** pour rep√©rer des vuln√©rabilit√©s ou anomalies. 
3. **`make workflow-attack-example`** : d√©ploie l‚Äôinfrastructure compl√®te (attaque incluse).  
4. **`make deploy`** : deploie via ansible par defaut sur votre machine le scenario docker compose.  
5. **`make build`** : construire l'image "custum-network-analysis"
6. **`make build dev`** : demarrer l'image "custum-network-analysis", elle necessite un acces au logs nginx.

Comme vous le voyer pour le 6. on peux aussi composer des action sur make, ici on va s'assurer de "build" le container avant de le lancr en "dev"

---

### 6. Ressources pour aller plus loin

- *Compose file reference* (Docker docs) ‚Äî toutes les cl√©s possibles.
- *Modern Make* (blog) ‚Äî bonnes pratiques Makefile.
- *Dive* (outil) ‚Äî analysez la taille de vos images.
- *Hadolint* ‚Äî linter Dockerfile.
